<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper
  PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
  "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="Supplier">
	<insert id="insertSupplier" parameterType="com.charida.app.supplier.dto.SupplierDto">
		INSERT INTO CRD_COMPANY 
		VALUES(#{mem_id}, #{regist_num}, #{explanation}, #{name}, #{maximum_seating}, #{cert_file_id}, #{telegram_id},#{minimum_seating}) 
	</insert>
	<select id = "checkSupplierNum" parameterType="int" resultType="int">
		SELECT COUNT(*) FROM CRD_COMPANY WHERE REGIST_NUM = #{supplierNumber}
	</select>
	
	<select id = "selectServiceCategoryMaxSeq" parameterType = "String" resultType= "String" >
		SELECT MAX(TYPE_SEQ) FROM CRD_SERVICE_TYPE WHERE MEM_ID = #{mem_id} 
	</select>
	<insert id="insertServiceCategoryType" parameterType="java.util.Map">
	 	 <foreach item="item" collection="list" open="INSERT ALL"  close="SELECT * FROM DUAL" separator=" " >
		INTO CRD_SERVICE_TYPE 
		values
			(#{item.mem_id},#{item.type_seq},#{item.type_code})
		</foreach>
	</insert>
	
	<select id = "selectFoodStyleMaxSeq" parameterType = "String" resultType= "String" >
		SELECT MAX(FOOD_STYLE_SEQ) FROM CRD_FOOD_STYLE WHERE MEM_ID = #{mem_id} 
	</select>
	<insert id="insertFoodStyle" parameterType="java.util.Map">
	 	 <foreach item="item" collection="list" open="INSERT ALL"  close="SELECT * FROM DUAL" separator=" " >
		INTO CRD_FOOD_STYLE 
		values
			(#{item.mem_id},#{item.style_seq},#{item.food_style_cood})
		</foreach>
	</insert>
	
	<select id = "selectServiceLocationMaxSeq" parameterType = "String" resultType= "String" >
		SELECT MAX(AREA_SEQ) FROM CRD_SERVICE_AREA WHERE MEM_ID = #{mem_id} 
	</select>
	<insert id="insertServiceLocation" parameterType="java.util.Map">
	 	 <foreach item="item" collection="list" open="INSERT ALL"  close="SELECT * FROM DUAL" separator=" " >
		INTO CRD_SERVICE_AREA 
		values
			(#{item.mem_id},#{item.area_seq},#{item.service_area_code})
		</foreach>
	</insert>
	
	<select id = "selectIntroFileMaxSeq" parameterType = "String" resultType= "String" >
		SELECT MAX(INTRO_SEQ) FROM CRD_INTRO_FILE WHERE MEM_ID = #{mem_id} 
	</select>
	<insert id="insertIntroFile" parameterType="java.util.Map">
	 	 <foreach item="item" collection="list" index="index" open="INSERT ALL"  close="SELECT * FROM DUAL" separator=" " >
		INTO CRD_INTRO_FILE 
		values
			(#{mem_id},#{intro_seq}+#{index},#{item})
		</foreach>
	</insert>
	
	<select id = "selectMemPermissionMaxSeq" parameterType = "String" resultType= "String" >
		SELECT MAX(PERMISSION_SEQ) FROM CRD_MEM_PERMISSION WHERE MEM_ID = #{mem_id} 
	</select>
	<insert id="insertPermission" parameterType="com.charida.app.supplier.dto.PermissionDto">
		INSERT INTO CRD_MEM_PERMISSION 
		VALUES(#{mem_id}, #{permission_seq}, #{permission_yn}, #{disallowance_reason}, sysdate) 
	</insert>
	
	<select id = "selectSuppliers" resultType="com.charida.app.supplier.dto.SupplierDto">
		SELECT * FROM CRD_COMPANY
	</select>
	
	<select id = "selectNotPermissionSuppliers" resultType = "hashMap">
		SELECT 
		C.MEM_ID mem_id,
		C.REGIST_NUM regist_num,
		C.EXPLANATION explanation,
		C.NAME companyname,
		C.MAXIMUM_SEATING maximum_seating,
		C.MINIMUM_SEATING minimum_seating,
		C.CERT_FILE_ID cert_file_id,
		C.TELEGRAM_ID telegram_id,
		M.NAME name,
		M.TEL tel,
		M.EMAIL email,
		M.JOIN_DATE join_date,
		P.PERMISSION_SEQ permission_seq,
		P.DISALLOWANCE_REASON disallowance_reason,
		P.MODIFICATION_DATE modification_date
		FROM CRD_COMPANY C , CRD_MEM M , CRD_MEM_PERMISSION P
		WHERE C.MEM_ID = M.MEM_ID 
		AND C.MEM_ID=P.MEM_ID
		AND P.PERMISSION_YN = 0 
	</select>
	
	<update id="updatePermission" parameterType="map">
		UPDATE CRD_MEM_PERMISSION 
		SET
		PERMISSION_SEQ = #{permission_seq[0]}, 
		PERMISSION_YN = #{permission_yn[0]},
		DISALLOWANCE_REASON = #{disallowance_reason[0],jdbcType=VARCHAR },
		MODIFICATION_DATE = sysdate
		WHERE 
		MEM_ID = #{mem_id[0]}
	</update>
	
</mapper>