<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper
  PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
  "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="Supplier">
	<insert id="insertSupplier" parameterType="com.charida.app.supplier.dto.SupplierDto">
		INSERT INTO CRD_COMPANY 
		VALUES(#{mem_id}, #{regist_num}, #{explanation}, #{name}, #{maximum_seating}, #{cert_file_id}, #{telegram_id},#{minimum_seating}) 
	</insert>
	<select id = "checkSupplierNum" parameterType="int" resultType="int">
		SELECT COUNT(*) FROM CRD_COMPANY WHERE REGIST_NUM = #{supplierNumber}
	</select>
	
	<select id = "selectServiceCategoryMaxSeq" parameterType = "String" resultType= "String" >
		SELECT MAX(TYPE_SEQ) FROM CRD_SERVICE_TYPE WHERE MEM_ID = #{mem_id} 
	</select>
	<insert id="insertServiceCategoryType" parameterType="java.util.Map">
	 	 <foreach item="item" collection="list" open="INSERT ALL"  close="SELECT * FROM DUAL" separator=" " >
		INTO CRD_SERVICE_TYPE 
		values
			(#{item.mem_id},#{item.type_seq},#{item.type_code})
		</foreach>
	</insert>
	
	<select id = "selectFoodStyleMaxSeq" parameterType = "String" resultType= "String" >
		SELECT MAX(FOOD_STYLE_SEQ) FROM CRD_FOOD_STYLE WHERE MEM_ID = #{mem_id} 
	</select>
	<insert id="insertFoodStyle" parameterType="java.util.Map">
	 	 <foreach item="item" collection="list" open="INSERT ALL"  close="SELECT * FROM DUAL" separator=" " >
		INTO CRD_FOOD_STYLE 
		values
			(#{item.mem_id},#{item.style_seq},#{item.food_style_cood})
		</foreach>
	</insert>
	
	<select id = "selectServiceLocationMaxSeq" parameterType = "String" resultType= "String" >
		SELECT MAX(AREA_SEQ) FROM CRD_SERVICE_AREA WHERE MEM_ID = #{mem_id} 
	</select>
	<insert id="insertServiceLocation" parameterType="java.util.Map">
	 	 <foreach item="item" collection="list" open="INSERT ALL"  close="SELECT * FROM DUAL" separator=" " >
		INTO CRD_SERVICE_AREA 
		values
			(#{item.mem_id},#{item.area_seq},#{item.service_area_code})
		</foreach>
	</insert>
	
	<select id = "selectIntroFileMaxSeq" parameterType = "String" resultType= "String" >
		SELECT MAX(INTRO_SEQ) FROM CRD_INTRO_FILE WHERE MEM_ID = #{mem_id} 
	</select>
	<insert id="insertIntroFile" parameterType="java.util.Map">
	 	 <foreach item="item" collection="list" index="index" open="INSERT ALL"  close="SELECT * FROM DUAL" separator=" " >
		INTO CRD_INTRO_FILE 
		values
			(#{mem_id},#{intro_seq}+#{index},#{item})
		</foreach>
	</insert>
	
	<select id = "selectMemPermissionMaxSeq" parameterType = "String" resultType= "String" >
		SELECT MAX(PERMISSION_SEQ) FROM CRD_MEM_PERMISSION WHERE MEM_ID = #{mem_id} 
	</select>
	<insert id="insertPermission" parameterType="com.charida.app.supplier.dto.PermissionDto">
		INSERT INTO CRD_MEM_PERMISSION 
		VALUES(#{mem_id}, #{permission_seq}, #{permission_yn}, #{disallowance_reason}, sysdate) 
	</insert>
	
	<select id = "selectSuppliers" resultType="com.charida.app.supplier.dto.SupplierDto">
		SELECT * FROM CRD_COMPANY
	</select>
	
	<resultMap type="com.charida.app.member.dto.MemberDto" id="memberDto">
		<result column="name" property="name"/>
		<result column="tel" property="tel"/>
		<result column="email" property="email"/>
		<result column="join_date" property="join_date"/>
	</resultMap>
	
	<resultMap type="com.charida.app.supplier.dto.SupplierDto" id="SupplierDto">
		<result column="mem_id" property="mem_id"/>
		<result column="regist_num" property="regist_num"/>
		<result column="explanation" property="explanation"/>
		<result column="name" property="name"/>
		<result column="maximum_seating" property="maximum_seating"/>
		<result column="minimum_seating" property="minimum_seating"/>
		<result column="telegram_id" property="telegram_id"/>
		<collection property="memberDto" resultMap="memberDto"/>
	</resultMap>
	
	<select id = "selectNotPermissionSuppliers" resultMap = "SupplierDto">
		SELECT 
		C.MEM_ID,
		C.REGIST_NUM,
		C.EXPLANATION,
		C.NAME,
		C.MAXIMUM_SEATING,
		C.MINIMUM_SEATING,
		C.CERT_FILE_ID,
		C.TELEGRAM_ID,
		M.NAME,
		M.TEL,
		M.EMAIL,
		M.JOIN_DATE
		FROM CRD_COMPANY C , CRD_MEM M , CRD_MEM_PERMISSION P
		WHERE C.MEM_ID = M.MEM_ID 
		AND C.MEM_ID=P.MEM_ID
		AND P.PERMISSION_YN = 0 
	</select>

</mapper>